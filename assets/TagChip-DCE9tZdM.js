import{E as B,k as v,j as $,D as c,G as f,H as d,r as h,o as m,g,w,e as S,t as T,h as j}from"./index-BRwGrxMU.js";const V=B("entries",()=>{const r=v([]),a=v([]),u=v(!1),i=v(null),y=$(()=>a.value.map(t=>t.taskId));async function p(t={}){try{u.value=!0;const e=await c.getEntries(t);r.value=e.entries}catch(e){i.value=e.message}finally{u.value=!1}}async function E(){try{const t=await c.getActiveEntries();a.value=t.entries}catch(t){i.value=t.message}}async function k(t){if(!f().isOnline){const n={id:`temp_${Date.now()}`,taskId:t,startTime:new Date().toISOString(),endTime:null,comment:null,_offline:!0};return a.value.push(n),await d.addToQueue({action:"start",payload:{taskId:t},tempId:n.id}),{entry:n,otherActiveEntries:[]}}try{const n=await c.startTask(t);return a.value.push(n.entry),n}catch(n){throw i.value=n.message,n}}async function O(t,e){if(!f().isOnline){const s=a.value.find(o=>o.taskId===t||o.id===e);return s&&(s.endTime=new Date().toISOString(),a.value=a.value.filter(o=>o.id!==s.id),r.value.unshift(s),await d.addToQueue({action:"stop",payload:{taskId:t,entryId:s.id}})),{entry:s}}try{const s=await c.stopTask(t,e);return a.value=a.value.filter(o=>o.id!==s.entry.id),r.value.unshift(s.entry),s}catch(s){throw i.value=s.message,s}}async function I(){if(!f().isOnline){const e=new Date().toISOString();return a.value.forEach(n=>{n.endTime=e,r.value.unshift(n)}),await d.addToQueue({action:"stopAll",payload:{}}),a.value=[],{stoppedCount:a.value.length}}try{const e=await c.stopAllTasks();return a.value=[],e.entries&&e.entries.forEach(n=>r.value.unshift(n)),e}catch(e){throw i.value=e.message,e}}async function C(t){const e=f(),n=a.value.filter(s=>s.taskId!==t);if(n.length===0)return{stoppedCount:0};if(!e.isOnline){const s=new Date().toISOString();return n.forEach(o=>{o.endTime=s,r.value.unshift(o)}),await d.addToQueue({action:"stopOthers",payload:{exceptTaskId:t}}),a.value=a.value.filter(o=>o.taskId===t),{stoppedCount:n.length}}try{for(const s of n){const o=await c.stopTask(s.taskId,s.id);a.value=a.value.filter(l=>l.id!==o.entry.id),r.value.unshift(o.entry)}return{stoppedCount:n.length}}catch(s){throw i.value=s.message,s}}async function A(t){try{const e=await c.createEntry(t);return r.value.unshift(e.entry),e.entry}catch(e){throw i.value=e.message,e}}async function D(t,e){try{const n=await c.updateEntry(t,e),s=r.value.findIndex(l=>l.id===t);s!==-1&&(r.value[s]=n.entry);const o=a.value.findIndex(l=>l.id===t);return o!==-1&&(a.value[o]=n.entry),n.entry}catch(n){throw i.value=n.message,n}}async function x(t){try{await c.deleteEntry(t),r.value=r.value.filter(e=>e.id!==t),a.value=a.value.filter(e=>e.id!==t)}catch(e){throw i.value=e.message,e}}function z(t){return a.value.some(e=>e.taskId===t)}function Q(t){return a.value.find(e=>e.taskId===t)}return{entries:r,activeEntries:a,loading:u,error:i,activeTaskIds:y,fetchEntries:p,fetchActiveEntries:E,startTask:k,stopTask:O,stopAllTasks:I,stopOtherTasks:C,createEntry:A,updateEntry:D,deleteEntry:x,isTaskRunning:z,getActiveEntry:Q}}),_={__name:"TagChip",props:{tag:{type:Object,required:!0},selected:{type:Boolean,default:!1},size:{type:String,default:"default"}},emits:["click"],setup(r){return(a,u)=>{const i=h("v-icon"),y=h("v-chip");return m(),g(y,{color:r.tag.color,variant:r.selected?"elevated":"tonal",size:r.size,onClick:u[0]||(u[0]=p=>a.$emit("click",r.tag))},{default:w(()=>[r.tag.icon?(m(),g(i,{key:0,start:"",size:"small"},{default:w(()=>[S(T(r.tag.icon),1)]),_:1})):j("",!0),S(" "+T(r.tag.name),1)]),_:1},8,["color","variant","size"])}}};export{_,V as u};
