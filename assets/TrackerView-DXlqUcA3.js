import{_ as Q,m as W,n as X,r as s,o as i,g as E,w as e,a,b as A,p as Y,t as b,c as _,F,q as I,e as m,h as D,j as O,k as g,s as Z,u as tt,i as R,T as L}from"./index-D5csk5LP.js";import{u as H,a as et}from"./tags-CdxEOehD.js";import{u as J,_ as at}from"./TagChip-DwTD9jQH.js";const ot={class:"flex-grow-1"},nt={key:0,class:"d-flex flex-wrap ga-1 mt-1"},lt={class:"text-right"},st={key:0,class:"text-h6 font-weight-bold text-white"},rt={__name:"TaskCard",props:{task:{type:Object,required:!0},activeEntry:{type:Object,default:null}},emits:["start","stop"],setup(y,{emit:z}){const d=y,c=z,x=H();J();const r=g(0);let p=null;const o=O(()=>!!d.activeEntry),u=O(()=>d.task.tags.map(v=>x.getTagById(v)).filter(Boolean)),f=O(()=>{const v=Math.floor(r.value/3600),V=Math.floor(r.value%3600/60),k=r.value%60;return v>0?`${v}:${String(V).padStart(2,"0")}:${String(k).padStart(2,"0")}`:`${V}:${String(k).padStart(2,"0")}`});function h(){if(d.activeEntry){const v=new Date(d.activeEntry.startTime);r.value=Math.floor((Date.now()-v)/1e3)}}function S(){p&&clearInterval(p),h(),p=setInterval(h,1e3)}function C(){p&&(clearInterval(p),p=null),r.value=0}W(()=>{o.value&&S()}),X(()=>{C()});function T(){o.value?c("stop",d.task.id,d.activeEntry?.id):c("start",d.task.id)}return(v,V)=>{const k=s("v-icon"),w=s("v-chip"),M=s("v-btn"),N=s("v-card-text"),j=s("v-card");return i(),E(j,{color:o.value?"primary":void 0,variant:o.value?"elevated":"tonal",class:"task-card",onClick:T},{default:e(()=>[a(N,{class:"d-flex align-center pa-3"},{default:e(()=>[a(k,{icon:y.task.icon||"mdi-checkbox-blank-circle",color:o.value?"white":y.task.color||"primary",size:"32",class:"mr-3"},null,8,["icon","color"]),A("div",ot,[A("div",{class:Y(["font-weight-medium",{"text-white":o.value}])},b(y.task.name),3),u.value.length>0?(i(),_("div",nt,[(i(!0),_(F,null,I(u.value,B=>(i(),E(w,{key:B.id,size:"x-small",color:o.value?"white":B.color,variant:o.value?"outlined":"tonal"},{default:e(()=>[a(k,{start:"",size:"12"},{default:e(()=>[m(b(B.icon),1)]),_:2},1024),m(" "+b(B.name),1)]),_:2},1032,["color","variant"]))),128))])):D("",!0)]),A("div",lt,[o.value?(i(),_("div",st,b(f.value),1)):D("",!0),a(M,{icon:o.value?"mdi-stop":"mdi-play",color:o.value?"white":"primary",variant:o.value?"outlined":"tonal",size:"small"},null,8,["icon","color","variant"])])]),_:1})]),_:1},8,["color","variant"])}}},P=Q(rt,[["__scopeId","data-v-7aab10a2"]]),it={__name:"CommentDialog",props:{modelValue:{type:Boolean,default:!1},entry:{type:Object,default:null}},emits:["update:modelValue","save"],setup(y,{emit:z}){const d=y,c=z,x=g("");Z(()=>d.entry,o=>{x.value=o?.comment||""});function r(){c("update:modelValue",!1)}function p(){c("save",x.value),r()}return(o,u)=>{const f=s("v-card-title"),h=s("v-textarea"),S=s("v-card-text"),C=s("v-spacer"),T=s("v-btn"),v=s("v-card-actions"),V=s("v-card"),k=s("v-dialog");return i(),E(k,{"model-value":y.modelValue,"max-width":"400","onUpdate:modelValue":u[1]||(u[1]=w=>o.$emit("update:modelValue",w))},{default:e(()=>[a(V,null,{default:e(()=>[a(f,null,{default:e(()=>[...u[2]||(u[2]=[m("Add Comment",-1)])]),_:1}),a(S,null,{default:e(()=>[a(h,{modelValue:x.value,"onUpdate:modelValue":u[0]||(u[0]=w=>x.value=w),label:"Comment",placeholder:"What did you work on?",rows:"3","auto-grow":"",autofocus:""},null,8,["modelValue"])]),_:1}),a(v,null,{default:e(()=>[a(C),a(T,{variant:"text",onClick:r},{default:e(()=>[...u[3]||(u[3]=[m("Skip",-1)])]),_:1}),a(T,{color:"primary",variant:"elevated",onClick:p},{default:e(()=>[...u[4]||(u[4]=[m("Save",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},ut={key:0,class:"d-flex flex-wrap ga-2 mb-4 hide-scrollbar",style:{"overflow-x":"auto"}},ct={key:1,class:"mb-6"},dt={class:"text-overline text-medium-emphasis mb-2"},vt={key:2},mt={class:"text-overline text-medium-emphasis mb-2"},pt={key:3,class:"text-center py-12"},yt={__name:"TrackerView",setup(y){const z=et(),d=H(),c=J(),x=tt(),r=g([]),p=g(!1),o=g(null),u=g(null),f=g(!1),h=g(0),S=g(!1),C=O(()=>{let n=z.activeTasks;return r.value.length>0&&(n=n.filter(t=>t.tags.some($=>r.value.includes($)))),n}),T=O(()=>C.value.filter(n=>c.isTaskRunning(n.id))),v=O(()=>C.value.filter(n=>!c.isTaskRunning(n.id))),V=O(()=>x.user?.settings?.allowMultipleTasks??!0);function k(n){const t=r.value.indexOf(n);t===-1?r.value.push(n):r.value.splice(t,1)}async function w(n){try{const t=await c.startTask(n);u.value=n,V.value&&t.otherActiveEntries?.length>0&&(h.value=t.otherActiveEntries.length,f.value=!0,setTimeout(()=>{f.value=!1},5e3))}catch(t){console.error("Failed to start task:",t)}}async function M(n,t){try{const $=await c.stopTask(n,t);o.value=$.entry,S.value=!0}catch($){console.error("Failed to stop task:",$)}}async function N(){try{await c.stopOtherTasks(u.value),f.value=!1}catch(n){console.error("Failed to stop other tasks:",n)}}function j(){S.value=!1,p.value=!0}async function B(n){o.value&&n&&await c.updateEntry(o.value.id,{comment:n}),o.value=null}return W(async()=>{await Promise.all([z.fetchTasks(),d.fetchTags(),c.fetchActiveEntries()])}),(n,t)=>{const $=s("v-chip"),q=s("v-icon"),U=s("v-btn"),G=s("v-snackbar"),K=s("v-container");return i(),E(K,{class:"pa-4"},{default:e(()=>[R(d).tags.length>0?(i(),_("div",ut,[a($,{variant:r.value.length===0?"elevated":"tonal",color:"primary",onClick:t[0]||(t[0]=l=>r.value=[])},{default:e(()=>[...t[5]||(t[5]=[m(" All ",-1)])]),_:1},8,["variant"]),(i(!0),_(F,null,I(R(d).tags,l=>(i(),E(at,{key:l.id,tag:l,selected:r.value.includes(l.id),onClick:ft=>k(l.id)},null,8,["tag","selected","onClick"]))),128))])):D("",!0),T.value.length>0?(i(),_("div",ct,[A("div",dt," Active ("+b(T.value.length)+") ",1),a(L,{name:"task-list",tag:"div",class:"d-flex flex-column ga-2"},{default:e(()=>[(i(!0),_(F,null,I(T.value,l=>(i(),E(P,{key:l.id,task:l,"active-entry":R(c).getActiveEntry(l.id),onStart:w,onStop:M},null,8,["task","active-entry"]))),128))]),_:1})])):D("",!0),v.value.length>0?(i(),_("div",vt,[A("div",mt," Tasks ("+b(v.value.length)+") ",1),a(L,{name:"task-list",tag:"div",class:"d-flex flex-column ga-2"},{default:e(()=>[(i(!0),_(F,null,I(v.value,l=>(i(),E(P,{key:l.id,task:l,onStart:w,onStop:M},null,8,["task"]))),128))]),_:1})])):D("",!0),C.value.length===0?(i(),_("div",pt,[a(q,{size:"64",color:"grey-lighten-1"},{default:e(()=>[...t[6]||(t[6]=[m("mdi-timer-off",-1)])]),_:1}),t[9]||(t[9]=A("div",{class:"text-h6 text-medium-emphasis mt-4"},"No tasks yet",-1)),t[10]||(t[10]=A("div",{class:"text-body-2 text-medium-emphasis"}," Go to Settings to create your first task ",-1)),a(U,{color:"primary",variant:"tonal",class:"mt-4",to:"/settings"},{default:e(()=>[a(q,{start:""},{default:e(()=>[...t[7]||(t[7]=[m("mdi-cog",-1)])]),_:1}),t[8]||(t[8]=m(" Open Settings ",-1))]),_:1})])):D("",!0),a(G,{modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=l=>f.value=l),location:"bottom",color:"info",timeout:"-1"},{actions:e(()=>[a(U,{variant:"text",onClick:N},{default:e(()=>[...t[11]||(t[11]=[m(" Stop others ",-1)])]),_:1}),a(U,{icon:"mdi-close",size:"small",variant:"text",onClick:t[1]||(t[1]=l=>f.value=!1)})]),default:e(()=>[m(b(h.value)+" other task"+b(h.value>1?"s":"")+" running ",1)]),_:1},8,["modelValue"]),a(G,{modelValue:S.value,"onUpdate:modelValue":t[3]||(t[3]=l=>S.value=l),location:"bottom",timeout:"5000"},{actions:e(()=>[a(U,{variant:"text",color:"primary",onClick:j},{default:e(()=>[...t[12]||(t[12]=[m(" Add comment ",-1)])]),_:1})]),default:e(()=>[t[13]||(t[13]=m(" Task stopped ",-1))]),_:1},8,["modelValue"]),a(it,{modelValue:p.value,"onUpdate:modelValue":t[4]||(t[4]=l=>p.value=l),entry:o.value,onSave:B},null,8,["modelValue","entry"])]),_:1})}}};export{yt as default};
